// ë°˜ë³„ ì‹œê°„í‘œ ë°ì´í„° (1ë°˜ë¶€í„° 4ë°˜ê¹Œì§€ ì œê³µëœ ì‹œê°„í‘œ ë°˜ì˜)
const classTimetables = {
    1: [
        ["1êµì‹œ", "ìƒëª…1", "ì²´ìœ¡ ì‹¤ê¸° ê¸°ì´ˆ", "ì˜ì–´ I", "ì²´ìœ¡ ì‹¤ê¸° ê¸°ì´ˆ", "ìœ¡ìƒ"],
        ["2êµì‹œ", "ìŠ¤í¬ì¸  ê°œë¡ ", "ì²´ìœ¡ ì‹¤ê¸° ê¸°ì´ˆ", "ë‹¨ì²´ ìš´ë™", "ì²´ìœ¡ ì‹¤ê¸° ê¸°ì´ˆ", "ë¬¸í•™"],
        ["3êµì‹œ", "ì˜ì–´ I", "ìš´ë™ê³¼ ê±´ê°•", "ìœ¡ìƒ", "ì˜ì–´ I", "ìŠ¤í¬ì¸  ê°œë¡ "],
        ["4êµì‹œ", "ìƒí™œê³¼ ìœ¤ë¦¬", "ì§„ë¡œ", "ìœ¡ìƒ", "ìŠ¤ì–´ I", "ìƒëª…1"],
        ["5êµì‹œ", "ìˆ˜í•™ I", "ìŠ¤í¬ì¸  ê°œë¡ ", "", "ìƒí™œê³¼ ìœ¤ë¦¬", "ìŠ¤ì–´ I"],
        ["6êµì‹œ", "ë¬¸í•™", "ë¬¸í•™", "ì°½ì²´", "ìˆ˜í•™ I", "ì°½ì²´"],
        ["7êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "ìˆ˜í•™ I", "ğŸ ", "ë‹¨ì²´ ìš´ë™", "ì°½ì²´"]
    ],
    2: [
        ["1êµì‹œ", "ë§¤ë¯¸T", "ë¬¸í•™", "ìŠ¤ì–´ I", "ë¯¸ì „T", "ì˜ì–´ I"],
        ["2êµì‹œ", "ë§¤ë¯¸T", "ì§„ë¡œ", "ìˆ˜í•™ I", "ë¯¸ì „T", "ìˆ˜í•™ I"],
        ["3êµì‹œ", "ë§¤ë¯¸T", "ìƒëª…1", "ìƒí™œê³¼ ìœ¤ë¦¬", "ë¯¸ì „T", "ìš´ë™ê³¼ ê±´ê°•"],
        ["4êµì‹œ", "ë“œì‰", "ìŠ¤ì–´ I", "ì˜ì–´ I", "ë¯¸ì „", "ìƒí™œê³¼ ìœ¤ë¦¬"],
        ["5êµì‹œ", "ë¬¸í•™", "ìˆ˜í•™ I", "", "ë“œì‰T", "ë¬¸í•™"],
        ["6êµì‹œ", "ì˜ì–´ I", "ìš´ë™ê³¼ ê±´ê°•", "ì°½ì²´", "ë“œì‰T", "ì°½ì²´"],
        ["7êµì‹œ", "ìƒëª…1", "ìƒí™œê³¼ ìœ¤ë¦¬", "ğŸ ", "ë“œì‰", "ì°½ì²´"]
    ],
    3: [
        ["1êµì‹œ", "ìˆ˜í•™ I", "ìƒê³¼", "í•œë¬¸", "ìš´ë™ê³¼ ê±´ê°•", "2I"],
        ["2êµì‹œ", "2K", "ë¬¸í•™", "2H", "ë¬¸í•™", "ì˜ì–´ I"],
        ["3êµì‹œ", "2J", "2J", "ì˜ì–´ I", "2I", "ìˆ˜í•™ I"],
        ["4êµì‹œ", "ë¬¸í•™", "í•œë¬¸", "ìˆ˜í•™ I", "ìˆ˜í•™ I", "ìš´ë™ê³¼ ê±´ê°•"],
        ["5êµì‹œ", "ìƒê³¼", "2K", "", "ì˜ì–´ I", "ë¬¸í•™"],
        ["6êµì‹œ", "ì§„ë¡œ", "2I", "ì°½ì²´", "2H", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ì˜ì–´ I", "ğŸ ", "2J", "ì°½ì²´"]
    ],
    4: [
        ["1êµì‹œ", "ì˜ì–´ I", "ì˜ì–´ I", "ì¤‘ì–´ I", "2L", "2I"],
        ["2êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "ì§„ë¡œ", "2H", "ìˆ˜í•™ I", "ìˆ˜í•™ I"],
        ["3êµì‹œ", "2J", "2J", "ìƒê³¼", "2I", "ë¬¸í•™"],
        ["4êµì‹œ", "ìƒê³¼", "ì¤‘ì–´ I", "ìš´ë™ê³¼ ê±´ê°•", "ì˜ì–´ I", "2L"],
        ["5êµì‹œ", "ë¬¸í•™", "ìˆ˜í•™ I", "", "ë¬¸í•™", "ì˜ì–´ I"],
        ["6êµì‹œ", "ìˆ˜í•™ I", "2I", "ì°½ì²´", "2H", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ë¬¸í•™", "ğŸ ", "2J", "ì°½ì²´"]
    ],
    5: [
        ["1êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "ìš´ë™ê³¼ ê±´ê°•", "ì˜ì–´ I", "2L", "2I"],
        ["2êµì‹œ", "ì§„ë¡œ", "ìˆ˜í•™ I", "2H", "ì˜ì–´ I", "ìƒê³¼"],
        ["3êµì‹œ", "2J", "2J", "ìˆ˜í•™ I", "2I", "ë¬¸í•™"],
        ["4êµì‹œ", "ì˜ì–´ I", "ì˜ì–´ I", "ë¬¸í•™", "ì¤‘ì–´ I", "2L"],
        ["5êµì‹œ", "ìˆ˜í•™ I", "ë¬¸í•™", "", "ìˆ˜í•™ I", "ì¤‘ì–´ I"],
        ["6êµì‹œ", "ë¬¸í•™", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ìƒê³¼", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
    6: [
        ["1êµì‹œ", "ë¬¸í•™", "ìˆ˜í•™ I", "ì‚¬íƒ", "ìˆ˜í•™ I", "2I"],
        ["2êµì‹œ", "2K", "ìŠ¤ì–´ I", "2H", "ì˜ì–´ I", "ìŠ¤ì–´ I"],
        ["3êµì‹œ", "2J", "2J", "ì˜ì–´ I", "2I", "ì˜ì–´ I"],
        ["4êµì‹œ", "ìˆ˜í•™ I", "ë¬¸í•™", "ë¬¸í•™", "ë¬¸í•™", "ì‚¬íƒ"],
        ["5êµì‹œ", "ì§„ë¡œ", "2K", "", "ìš´ë™ê³¼ ê±´ê°•", "ìˆ˜í•™ I"],
        ["6êµì‹œ", "ì˜ì–´ I", "2I", "ì°½ì²´", "2H", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ìš´ë™ê³¼ ê±´ê°•", "ğŸ ", "2J", "ì°½ì²´"]
    ],
    7: [
        ["1êµì‹œ", "ìŠ¤ì–´ I", "ìˆ˜í•™ I", "ë¬¸í•™", "ì˜ì–´ I", "2I"],
        ["2êµì‹œ", "ë¬¸í•™", "2M", "2H", "ìŠ¤ì–´ I", "ì‚¬íƒ"],
        ["3êµì‹œ", "2J", "2J", "ìš´ë™ê³¼ ê±´ê°•", "2I", "2M"],
        ["4êµì‹œ", "ìˆ˜í•™ I", "ë¬¸í•™", "ì˜ì–´ I", "ìˆ˜í•™ I", "ì§„ë¡œ"],
        ["5êµì‹œ", "ì˜ì–´ I", "ì˜ì–´ I", "", "ë¬¸í•™", "ìˆ˜í•™ I"],
        ["6êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ì‚¬íƒ", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
    8: [
        ["1êµì‹œ", "ì˜ì–´ I", "ì‚¬íƒ", "ì˜ì–´ I", "2L", "2I"],
        ["2êµì‹œ", "ì°½ì§„", "ë¬¸í•™", "2H", "ìˆ˜í•™ I", "ë¬¸í•™"],
        ["3êµì‹œ", "2J", "2J", "ìˆ˜í•™ I", "2I", "ì˜ì–´ I"],
        ["4êµì‹œ", "ë¬¸í•™", "ìˆ˜í•™ I", "ìŠ¤ì–´ I", "ë¬¸í•™", "2L"],
        ["5êµì‹œ", "ì‚¬íƒ", "ìš´ë™ê³¼ ê±´ê°•", "", "ìŠ¤ì–´ I", "ìš´ë™ê³¼ ê±´ê°•"],
        ["6êµì‹œ", "ìˆ˜í•™ I", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ì˜ì–´ I", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
    9: [
        ["1êµì‹œ", "ìˆ˜í•™ I", "ì˜ì–´ I", "ìƒê³¼", "ìŠ¤ì–´ I", "2I"],
        ["2êµì‹œ", "ì§„ë¡œ", "2M", "2H", "ì˜ì–´ I", "ìˆ˜í•™ I"],
        ["3êµì‹œ", "2J", "2J", "ë¬¸í•™", "2I", "2M"],
        ["4êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "ìš´ë™ê³¼ ê±´ê°•", "ì˜ì–´ I", "ë¬¸í•™", "ìƒê³¼"],
        ["5êµì‹œ", "ë¬¸í•™", "ìˆ˜í•™ I", "", "ìˆ˜í•™ I", "ì˜ì–´ I"],
        ["6êµì‹œ", "ìŠ¤ì–´ I", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ë¬¸í•™", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
    10: [
        ["1êµì‹œ", "ë¬¸í•™", "ë¬¸í•™", "ìš´ë™ê³¼ ê±´ê°•", "ì‚¬íƒ", "2I"],
        ["2êµì‹œ", "ìˆ˜í•™ I", "ì§„ë¡œ", "2H", "ë¬¸í•™", "ë¬¸í•™"],
        ["3êµì‹œ", "2J", "2J", "ìŠ¤ì–´ I", "2I", "ìˆ˜í•™ I"],
        ["4êµì‹œ", "ìŠ¤ì–´ I", "ì˜ì–´ I", "ìˆ˜í•™ I", "ì˜ì–´ I", "ì˜ì–´ I"],
        ["5êµì‹œ", "ìš´ë™ê³¼ ê±´ê°•", "ì‚¬íƒ", "", "2N", "2N"],
        ["6êµì‹œ", "ì˜ì–´ I", "2I", "ì°½ì²´", "2H", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ìˆ˜í•™ I", "ğŸ ", "2J", "ì°½ì²´"]
    ],
    11: [
        ["1êµì‹œ", "ìˆ˜í•™ I", "ìˆ˜í•™ I", "ì˜ì–´ I", "ìƒê³¼", "2I"],
        ["2êµì‹œ", "ì˜ì–´ I", "ë¬¸í•™", "2H", "ìˆ˜í•™ I", "ìš´ë™ê³¼ ê±´ê°•"],
        ["3êµì‹œ", "2J", "2J", "ìˆ˜í•™ I", "2I", "ë¬¸í•™"],
        ["4êµì‹œ", "ë¬¸í•™", "ì˜ì–´ I", "ë¬¸í•™", "ìš´ë™ê³¼ ê±´ê°•", "ì˜ì–´ I"],
        ["5êµì‹œ", "ìŠ¤ì–´ I", "ìƒê³¼", "", "2N", "2N"],
        ["6êµì‹œ", "ì§„ë¡œ", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ìŠ¤ì–´ I", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
    12: [
        ["1êµì‹œ", "ì˜ì–´ I", "ìŠ¤ì–´ I", "ë¬¸í•™", "ì§„ë¡œ", "2I"],
        ["2êµì‹œ", "ê¸°í•˜", "ìš´ë™ê³¼ ê±´ê°•", "2H", "ìš´ë™ê³¼ ê±´ê°•", "ì˜ì–´ I"],
        ["3êµì‹œ", "2J", "2J", "ì‚¬íƒ", "2I", "ìŠ¤ì–´ I"],
        ["4êµì‹œ", "ì‚¬íƒ", "ìˆ˜í•™ I", "ìˆ˜í•™ I", "ìˆ˜í•™ I", "ë¬¸í•™"],
        ["5êµì‹œ", "ìˆ˜í•™ I", "ë¬¸í•™", "", "ì˜ì–´ I", "ê¸°í•˜"],
        ["6êµì‹œ", "ë¬¸í•™", "2I", "ì°½ì²´", "2H ", "ì°½ì²´"],
        ["7êµì‹œ", "2H", "ì˜ì–´ I", "ğŸ ", "2J ", "ì°½ì²´"]
    ],
};

//##################################################################


// ìƒ‰ìƒ ë§¤í•‘ (ì„ íƒê³¼ëª© ê·¸ë£¹ë³„ ìƒ‰ìƒ)
const colors = {
    "ìˆ˜í•™ I": "#FFCCCC", "ìƒê³¼": "#CCE5FF", "í•œë¬¸": "#FFFFCC", "ìš´ë™ê³¼ ê±´ê°•": "#CCFFCC",
    "ë¬¸í•™": "#FFCCFF", "ì˜ì–´ I": "#FFCC99", "ì°½ì²´": "#CCCCFF", "ì§„ë¡œ": "#D1D1E0",
    "ì—†ìŒ": "#FFFFFF",
    "Iì„ íƒ": "#FF9999",  // Iì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Kì„ íƒ": "#99CCFF",  // Kì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Hì„ íƒ": "#FFCC66",  // Hì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Jì„ íƒ": "#99FF99",  // Jì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Lì„ íƒ": "#CC99FF",  // Lì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Mì„ íƒ": "#FF9966",  // Mì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "Nì„ íƒ": "#99CC99",  // Nì„ íƒ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "ê¸°í•˜": "#99CC99",
    "ì–¸ì–´": "#FFCC99",   // ì–¸ì–´ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ
    "ì‚¬ë¬¸/ìƒê³¼": "#CCCCFF" // ì‚¬ë¬¸/ìƒê³¼ ê·¸ë£¹ ê¸°ë³¸ ìƒ‰ìƒ

    
};

// ì‹œê°„í‘œ ìƒì„± í•¨ìˆ˜
function createTimetable(classNumber) {
    const tbody = document.querySelector("table tbody");
    tbody.innerHTML = ""; // ê¸°ì¡´ ì‹œê°„í‘œ ì´ˆê¸°í™”

    const timetable = classTimetables[classNumber];
    if (!timetable) return;

    timetable.forEach((row) => {
        const tr = document.createElement("tr");
        row.forEach((cell, colIndex) => {
            const td = document.createElement("td");
            if (colIndex === 0) { 
                td.textContent = cell;
            } else if (cell.startsWith("2")) { 
                const electiveType = cell[1] + "ì„ íƒ"; 
                const selectedValue = document.getElementById(electiveType).value;
                td.textContent = selectedValue === "ì—†ìŒ" ? "" : selectedValue;
                td.style.backgroundColor = colors[electiveType];
            } else if (cell === "ìŠ¤ì–´ I" || cell === "ì¤‘ì–´ I" || cell === "í•œë¬¸") { 
                const selectedValue = document.getElementById("ì–¸ì–´ì„ íƒ").value;
                td.textContent = selectedValue;
                td.style.backgroundColor = colors["ì–¸ì–´"];
            } else if (cell === "ìƒê³¼" || cell === "ì‚¬íƒ") { 
                const selectedValue = document.getElementById("ì‚¬ë¬¸ìƒê³¼ì„ íƒ").value;
                td.textContent = selectedValue;
                td.style.backgroundColor = colors["ì‚¬ë¬¸/ìƒê³¼"];
            } else { 
                td.textContent = cell;
                td.style.backgroundColor = colors[cell] || "#e0e5ec";
            }
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

// âœ… **ë°˜ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**
document.getElementById("classSelect").addEventListener("change", (e) => {
    createTimetable(e.target.value);
});

// âœ… **ì„ íƒê³¼ëª© ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**
document.querySelectorAll("#electiveMenu select").forEach(select => {
    select.addEventListener("change", () => {
        createTimetable(document.getElementById("classSelect").value);
    });
});

// âœ… **ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì„ íƒê³¼ëª© ë°˜ì˜)**
document.getElementById("downloadBtn").addEventListener("click", async () => {
    const userSettings = {
        classSelect: document.getElementById("classSelect").value,
        Kì„ íƒ: document.getElementById("Kì„ íƒ").value,
        Lì„ íƒ: document.getElementById("Lì„ íƒ").value,
        Mì„ íƒ: document.getElementById("Mì„ íƒ").value,
        Nì„ íƒ: document.getElementById("Nì„ íƒ").value,
        Iì„ íƒ: document.getElementById("Iì„ íƒ").value,
        Hì„ íƒ: document.getElementById("Hì„ íƒ").value,
        Jì„ íƒ: document.getElementById("Jì„ íƒ").value,
        ì–¸ì–´ì„ íƒ: document.getElementById("ì–¸ì–´ì„ íƒ").value,
        ì‚¬ë¬¸ìƒê³¼ì„ íƒ: document.getElementById("ì‚¬ë¬¸ìƒê³¼ì„ íƒ").value
    };

    try {
        const response = await fetch("/capture", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(userSettings)
        });

        if (!response.ok) throw new Error("ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨");

        const blob = await response.blob();
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "timetable_highres.png";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error("ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:", error);
        alert("ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
});

// âœ… **ì´ˆê¸° 1ë°˜ ì‹œê°„í‘œ ìƒì„±**
window.onload = () => {
    createTimetable(1);
};