// λ°λ³„ μ‹κ°„ν‘ λ°μ΄ν„° (1λ°λ¶€ν„° 4λ°κΉμ§€ μ κ³µλ μ‹κ°„ν‘ λ°μ)
const classTimetables = {
    1: [
        ["1κµμ‹", "μƒλ…1", "μ²΄μ΅ μ‹¤κΈ° κΈ°μ΄", "μμ–΄ I", "μ²΄μ΅ μ‹¤κΈ° κΈ°μ΄", "μ΅μƒ"],
        ["2κµμ‹", "μ¤ν¬μΈ  κ°λ΅ ", "μ²΄μ΅ μ‹¤κΈ° κΈ°μ΄", "λ‹¨μ²΄ μ΄λ™", "μ²΄μ΅ μ‹¤κΈ° κΈ°μ΄", "λ¬Έν•™"],
        ["3κµμ‹", "μμ–΄ I", "μ΄λ™κ³Ό κ±΄κ°•", "μ΅μƒ", "μμ–΄ I", "μ¤ν¬μΈ  κ°λ΅ "],
        ["4κµμ‹", "μƒν™κ³Ό μ¤λ¦¬", "μ§„λ΅", "μ΅μƒ", "μ¤μ–΄ I", "μƒλ…1"],
        ["5κµμ‹", "μν•™ I", "μ¤ν¬μΈ  κ°λ΅ ", "", "μƒν™κ³Ό μ¤λ¦¬", "μ¤μ–΄ I"],
        ["6κµμ‹", "λ¬Έν•™", "λ¬Έν•™", "μ°½μ²΄", "μν•™ I", "μ°½μ²΄"],
        ["7κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "μν•™ I", "π ", "λ‹¨μ²΄ μ΄λ™", "μ°½μ²΄"]
    ],
    2: [
        ["1κµμ‹", "λ§¤λ―ΈT", "λ¬Έν•™", "μ¤μ–΄ I", "λ―Έμ „T", "μμ–΄ I"],
        ["2κµμ‹", "λ§¤λ―ΈT", "μ§„λ΅", "μν•™ I", "λ―Έμ „T", "μν•™ I"],
        ["3κµμ‹", "λ§¤λ―ΈT", "μƒλ…1", "μƒν™κ³Ό μ¤λ¦¬", "λ―Έμ „T", "μ΄λ™κ³Ό κ±΄κ°•"],
        ["4κµμ‹", "λ“μ‰", "μ¤μ–΄ I", "μμ–΄ I", "λ―Έμ „", "μƒν™κ³Ό μ¤λ¦¬"],
        ["5κµμ‹", "λ¬Έν•™", "μν•™ I", "", "λ“μ‰T", "λ¬Έν•™"],
        ["6κµμ‹", "μμ–΄ I", "μ΄λ™κ³Ό κ±΄κ°•", "μ°½μ²΄", "λ“μ‰T", "μ°½μ²΄"],
        ["7κµμ‹", "μƒλ…1", "μƒν™κ³Ό μ¤λ¦¬", "π ", "λ“μ‰", "μ°½μ²΄"]
    ],
    3: [
        ["1κµμ‹", "μν•™ I", "μƒκ³Ό", "ν•λ¬Έ", "μ΄λ™κ³Ό κ±΄κ°•", "2I"],
        ["2κµμ‹", "2K", "λ¬Έν•™", "2H", "λ¬Έν•™", "μμ–΄ I"],
        ["3κµμ‹", "2J", "2J", "μμ–΄ I", "2I", "μν•™ I"],
        ["4κµμ‹", "λ¬Έν•™", "ν•λ¬Έ", "μν•™ I", "μν•™ I", "μ΄λ™κ³Ό κ±΄κ°•"],
        ["5κµμ‹", "μƒκ³Ό", "2K", "", "μμ–΄ I", "λ¬Έν•™"],
        ["6κµμ‹", "μ§„λ΅", "2I", "μ°½μ²΄", "2H", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μμ–΄ I", "π ", "2J", "μ°½μ²΄"]
    ],
    4: [
        ["1κµμ‹", "μμ–΄ I", "μμ–΄ I", "μ¤‘μ–΄ I", "2L", "2I"],
        ["2κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "μ§„λ΅", "2H", "μν•™ I", "μν•™ I"],
        ["3κµμ‹", "2J", "2J", "μƒκ³Ό", "2I", "λ¬Έν•™"],
        ["4κµμ‹", "μƒκ³Ό", "μ¤‘μ–΄ I", "μ΄λ™κ³Ό κ±΄κ°•", "μμ–΄ I", "2L"],
        ["5κµμ‹", "λ¬Έν•™", "μν•™ I", "", "λ¬Έν•™", "μμ–΄ I"],
        ["6κµμ‹", "μν•™ I", "2I", "μ°½μ²΄", "2H", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "λ¬Έν•™", "π ", "2J", "μ°½μ²΄"]
    ],
    5: [
        ["1κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "μ΄λ™κ³Ό κ±΄κ°•", "μμ–΄ I", "2L", "2I"],
        ["2κµμ‹", "μ§„λ΅", "μν•™ I", "2H", "μμ–΄ I", "μƒκ³Ό"],
        ["3κµμ‹", "2J", "2J", "μν•™ I", "2I", "λ¬Έν•™"],
        ["4κµμ‹", "μμ–΄ I", "μμ–΄ I", "λ¬Έν•™", "μ¤‘μ–΄ I", "2L"],
        ["5κµμ‹", "μν•™ I", "λ¬Έν•™", "", "μν•™ I", "μ¤‘μ–΄ I"],
        ["6κµμ‹", "λ¬Έν•™", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μƒκ³Ό", "π ", "2J ", "μ°½μ²΄"]
    ],
    6: [
        ["1κµμ‹", "λ¬Έν•™", "μν•™ I", "μ‚¬νƒ", "μν•™ I", "2I"],
        ["2κµμ‹", "2K", "μ¤μ–΄ I", "2H", "μμ–΄ I", "μ¤μ–΄ I"],
        ["3κµμ‹", "2J", "2J", "μμ–΄ I", "2I", "μμ–΄ I"],
        ["4κµμ‹", "μν•™ I", "λ¬Έν•™", "λ¬Έν•™", "λ¬Έν•™", "μ‚¬νƒ"],
        ["5κµμ‹", "μ§„λ΅", "2K", "", "μ΄λ™κ³Ό κ±΄κ°•", "μν•™ I"],
        ["6κµμ‹", "μμ–΄ I", "2I", "μ°½μ²΄", "2H", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μ΄λ™κ³Ό κ±΄κ°•", "π ", "2J", "μ°½μ²΄"]
    ],
    7: [
        ["1κµμ‹", "μ¤μ–΄ I", "μν•™ I", "λ¬Έν•™", "μμ–΄ I", "2I"],
        ["2κµμ‹", "λ¬Έν•™", "2M", "2H", "μ¤μ–΄ I", "μ‚¬νƒ"],
        ["3κµμ‹", "2J", "2J", "μ΄λ™κ³Ό κ±΄κ°•", "2I", "2M"],
        ["4κµμ‹", "μν•™ I", "λ¬Έν•™", "μμ–΄ I", "μν•™ I", "μ§„λ΅"],
        ["5κµμ‹", "μμ–΄ I", "μμ–΄ I", "", "λ¬Έν•™", "μν•™ I"],
        ["6κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μ‚¬νƒ", "π ", "2J ", "μ°½μ²΄"]
    ],
    8: [
        ["1κµμ‹", "μμ–΄ I", "μ‚¬νƒ", "μμ–΄ I", "2L", "2I"],
        ["2κµμ‹", "μ°½μ§„", "λ¬Έν•™", "2H", "μν•™ I", "λ¬Έν•™"],
        ["3κµμ‹", "2J", "2J", "μν•™ I", "2I", "μμ–΄ I"],
        ["4κµμ‹", "λ¬Έν•™", "μν•™ I", "μ¤μ–΄ I", "λ¬Έν•™", "2L"],
        ["5κµμ‹", "μ‚¬νƒ", "μ΄λ™κ³Ό κ±΄κ°•", "", "μ¤μ–΄ I", "μ΄λ™κ³Ό κ±΄κ°•"],
        ["6κµμ‹", "μν•™ I", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μμ–΄ I", "π ", "2J ", "μ°½μ²΄"]
    ],
    9: [
        ["1κµμ‹", "μν•™ I", "μμ–΄ I", "μƒκ³Ό", "μ¤μ–΄ I", "2I"],
        ["2κµμ‹", "μ§„λ΅", "2M", "2H", "μμ–΄ I", "μν•™ I"],
        ["3κµμ‹", "2J", "2J", "λ¬Έν•™", "2I", "2M"],
        ["4κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "μ΄λ™κ³Ό κ±΄κ°•", "μμ–΄ I", "λ¬Έν•™", "μƒκ³Ό"],
        ["5κµμ‹", "λ¬Έν•™", "μν•™ I", "", "μν•™ I", "μμ–΄ I"],
        ["6κµμ‹", "μ¤μ–΄ I", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "λ¬Έν•™", "π ", "2J ", "μ°½μ²΄"]
    ],
    10: [
        ["1κµμ‹", "λ¬Έν•™", "λ¬Έν•™", "μ΄λ™κ³Ό κ±΄κ°•", "μ‚¬νƒ", "2I"],
        ["2κµμ‹", "μν•™ I", "μ§„λ΅", "2H", "λ¬Έν•™", "λ¬Έν•™"],
        ["3κµμ‹", "2J", "2J", "μ¤μ–΄ I", "2I", "μν•™ I"],
        ["4κµμ‹", "μ¤μ–΄ I", "μμ–΄ I", "μν•™ I", "μμ–΄ I", "μμ–΄ I"],
        ["5κµμ‹", "μ΄λ™κ³Ό κ±΄κ°•", "μ‚¬νƒ", "", "2N", "2N"],
        ["6κµμ‹", "μμ–΄ I", "2I", "μ°½μ²΄", "2H", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μν•™ I", "π ", "2J", "μ°½μ²΄"]
    ],
    11: [
        ["1κµμ‹", "μν•™ I", "μν•™ I", "μμ–΄ I", "μƒκ³Ό", "2I"],
        ["2κµμ‹", "μμ–΄ I", "λ¬Έν•™", "2H", "μν•™ I", "μ΄λ™κ³Ό κ±΄κ°•"],
        ["3κµμ‹", "2J", "2J", "μν•™ I", "2I", "λ¬Έν•™"],
        ["4κµμ‹", "λ¬Έν•™", "μμ–΄ I", "λ¬Έν•™", "μ΄λ™κ³Ό κ±΄κ°•", "μμ–΄ I"],
        ["5κµμ‹", "μ¤μ–΄ I", "μƒκ³Ό", "", "2N", "2N"],
        ["6κµμ‹", "μ§„λ΅", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μ¤μ–΄ I", "π ", "2J ", "μ°½μ²΄"]
    ],
    12: [
        ["1κµμ‹", "μμ–΄ I", "μ¤μ–΄ I", "λ¬Έν•™", "μ§„λ΅", "2I"],
        ["2κµμ‹", "κΈ°ν•", "μ΄λ™κ³Ό κ±΄κ°•", "2H", "μ΄λ™κ³Ό κ±΄κ°•", "μμ–΄ I"],
        ["3κµμ‹", "2J", "2J", "μ‚¬νƒ", "2I", "μ¤μ–΄ I"],
        ["4κµμ‹", "μ‚¬νƒ", "μν•™ I", "μν•™ I", "μν•™ I", "λ¬Έν•™"],
        ["5κµμ‹", "μν•™ I", "λ¬Έν•™", "", "μμ–΄ I", "κΈ°ν•"],
        ["6κµμ‹", "λ¬Έν•™", "2I", "μ°½μ²΄", "2H ", "μ°½μ²΄"],
        ["7κµμ‹", "2H", "μμ–΄ I", "π ", "2J ", "μ°½μ²΄"]
    ],
};

//##################################################################


// μƒ‰μƒ λ§¤ν•‘ (μ„ νƒκ³Όλ© κ·Έλ£Ήλ³„ μƒ‰μƒ)
const colors = {
    "μν•™ I": "#FFCCCC", "μƒκ³Ό": "#CCE5FF", "ν•λ¬Έ": "#FFFFCC", "μ΄λ™κ³Ό κ±΄κ°•": "#CCFFCC",
    "λ¬Έν•™": "#FFCCFF", "μμ–΄ I": "#FFCC99", "μ°½μ²΄": "#CCCCFF", "μ§„λ΅": "#D1D1E0",
    "μ—†μ": "#FFFFFF",
    "Iμ„ νƒ": "#FF9999",  // Iμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Kμ„ νƒ": "#99CCFF",  // Kμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Hμ„ νƒ": "#FFCC66",  // Hμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Jμ„ νƒ": "#99FF99",  // Jμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Lμ„ νƒ": "#CC99FF",  // Lμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Mμ„ νƒ": "#FF9966",  // Mμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "Nμ„ νƒ": "#99CC99",  // Nμ„ νƒ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "κΈ°ν•": "#99CC99",
    "μ–Έμ–΄": "#FFCC99",   // μ–Έμ–΄ κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ
    "μ‚¬λ¬Έ/μƒκ³Ό": "#CCCCFF" // μ‚¬λ¬Έ/μƒκ³Ό κ·Έλ£Ή κΈ°λ³Έ μƒ‰μƒ

    
};

// μ‹κ°„ν‘ μƒμ„± ν•¨μ
function createTimetable(classNumber) {
    const tbody = document.querySelector("table tbody");
    tbody.innerHTML = ""; // κΈ°μ΅΄ μ‹κ°„ν‘ μ΄κΈ°ν™”

    const timetable = classTimetables[classNumber];
    if (!timetable) return;

    timetable.forEach((row) => {
        const tr = document.createElement("tr");
        row.forEach((cell, colIndex) => {
            const td = document.createElement("td");
            if (colIndex === 0) { 
                td.textContent = cell;
            } else if (cell.startsWith("2")) { 
                const electiveType = cell[1] + "μ„ νƒ"; 
                const selectedValue = document.getElementById(electiveType).value;
                td.textContent = selectedValue === "μ—†μ" ? "" : selectedValue;
                td.style.backgroundColor = colors[electiveType];
            } else if (cell === "μ¤μ–΄ I" || cell === "μ¤‘μ–΄ I" || cell === "ν•λ¬Έ") { 
                const selectedValue = document.getElementById("μ–Έμ–΄μ„ νƒ").value;
                td.textContent = selectedValue;
                td.style.backgroundColor = colors["μ–Έμ–΄"];
            } else if (cell === "μƒκ³Ό" || cell === "μ‚¬νƒ") { 
                const selectedValue = document.getElementById("μ‚¬λ¬Έμƒκ³Όμ„ νƒ").value;
                td.textContent = selectedValue;
                td.style.backgroundColor = colors["μ‚¬λ¬Έ/μƒκ³Ό"];
            } else { 
                td.textContent = cell;
                td.style.backgroundColor = colors[cell] || "#e0e5ec";
            }
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

// β… **λ° μ„ νƒ λ³€κ²½ μ΄λ²¤νΈ λ¦¬μ¤λ„**
document.getElementById("classSelect").addEventListener("change", (e) => {
    createTimetable(e.target.value);
});

// β… **μ„ νƒκ³Όλ© λ³€κ²½ μ΄λ²¤νΈ λ¦¬μ¤λ„**
document.querySelectorAll("#electiveMenu select").forEach(select => {
    select.addEventListener("change", () => {
        createTimetable(document.getElementById("classSelect").value);
    });
});

// β… **λ‹¤μ΄λ΅λ“ λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ (μ„ νƒκ³Όλ© λ°μ)**
document.getElementById("downloadBtn").addEventListener("click", async () => {
    alert("μ΄λ―Έμ§€κ°€ 3μ΄ ν›„μ— λ‹¤μ΄λ΅λ“λ©λ‹λ‹¤.\nμΈκ³µμ§€λ¥λ¶€ λ§μ€ κ΄€μ‹¬ λ¶€νƒλ“λ¦½λ‹λ‹¤.")
    
    const userSettings = {
        classSelect: document.getElementById("classSelect").value,
        Kμ„ νƒ: document.getElementById("Kμ„ νƒ").value,
        Lμ„ νƒ: document.getElementById("Lμ„ νƒ").value,
        Mμ„ νƒ: document.getElementById("Mμ„ νƒ").value,
        Nμ„ νƒ: document.getElementById("Nμ„ νƒ").value,
        Iμ„ νƒ: document.getElementById("Iμ„ νƒ").value,
        Hμ„ νƒ: document.getElementById("Hμ„ νƒ").value,
        Jμ„ νƒ: document.getElementById("Jμ„ νƒ").value,
        μ–Έμ–΄μ„ νƒ: document.getElementById("μ–Έμ–΄μ„ νƒ").value,
        μ‚¬λ¬Έμƒκ³Όμ„ νƒ: document.getElementById("μ‚¬λ¬Έμƒκ³Όμ„ νƒ").value
    };

    try {
        const response = await fetch("/capture", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(userSettings)
        });

        if (!response.ok) throw new Error("μ΄λ―Έμ§€ λ‹¤μ΄λ΅λ“ μ‹¤ν¨");

        const blob = await response.blob();
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "timetable_highres.png";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error("λ‹¤μ΄λ΅λ“ μ¤λ¥:", error);
        alert("μ΄λ―Έμ§€λ¥Ό μ €μ¥ν•λ” μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.");
    }
});

// β… **μ΄κΈ° 1λ° μ‹κ°„ν‘ μƒμ„±**
window.onload = () => {
    createTimetable(1);
};

const copyBtn = document.getElementById("copy");

copyBtn.addEventListener("click", () => {
  // μµμ‹  λΈλΌμ°μ €μ—μ„ μ§€μ›ν•λ” Clipboard API μ‚¬μ©
  // writeTextλ΅ κ°„λ‹¨ν ν…μ¤νΈλ¥Ό λ³µμ‚¬ν•  μ μμµλ‹λ‹¤.
    navigator.clipboard.writeText("ν† μ¤λ±…ν¬ 1908-8747-1073")
    .then(() => {
        alert("κ³„μΆλ²νΈκ°€ λ³µμ‚¬λμ—μµλ‹λ‹¤!");
    })
    .catch((err) => {
        console.error("λ³µμ‚¬ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.", err);
    });
});






